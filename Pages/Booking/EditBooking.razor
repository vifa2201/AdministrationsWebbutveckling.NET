@page "/editbooking/{bookingId}"
<PageTitle>Redigera bokning</PageTitle>

<h2>Redigera bokning</h2>
@if (booking == null)
{
    <p>Bokningen kunde inte hämtas</p>
}
else 
{
    <form @onsubmit="UpdateBooking">
        <label for="@booking.Id">Id:</label>
        <input type="number" id="@booking.Id" @bind="@booking.Id" disabled class="form-control  "/>
        <br />
        <label for="@booking.Message">Meddelande:</label> <br>
        <textarea type="text" id="@booking.Message" @bind="@booking.Message" class="form-control  "></textarea> 
        <br />
         <label for="@booking.HairLength">Hårlängd</label>
        <input type="text" id="@booking.Id" @bind="@booking.HairLength" class="form-control  "/>
        <br />
            <label for="@booking.HairLength">Hårtyp</label>
        <input type="text" id="@booking.Id" @bind="@booking.HairType" class="form-control  "/>
        <br />
        <label for="@booking.Time.Date">Datum:</label>
        <input type="text" id="@booking.Time.Date" @bind="@booking.Time.Date" disabled  class="form-control  "/>
        <br />
         <label for="@booking.Time.Time">Tid:</label>
        <input type="text" id="@booking.Time.Time" @bind="@booking.Time.Time" disabled  class="form-control  "/>
        <br />
        <label for="@booking.HairdresserId">Frisör</label>
        <select class="form-select" id="@booking.HairdresserId" @bind="@booking.HairdresserId">
            <option value="" disabled selected>Välj frisör</option>
            @foreach (var h in hairdresser)
            {
                <option value="@h.Id">@h.Name</option>
            }
        </select>
        <br />
        <label for="@booking.CategoryId">Kategori</label>
        <select class="form-select" id="@booking.CategoryId" @bind="@booking.CategoryId">
            <option value="" disabled selected>Välj ett alternativ</option>
            @foreach (var c in category)
            {
                <option value="@c.Id">@c.Name</option>
            }
        </select>
        <br />
 
           <button type="submit" class="btn btn-standard mt-4">Spara</button>
        <a href="/booking" class="btn info mt-4">Tillbaka</a>
    </form>
}

@code {

    public Booking booking;
    public Hairdresser[] hairdresser;
    public Category[] category;
    public Times[] time;

    [Parameter]
    public string bookingId { get; set; }

    protected override async Task OnInitializedAsync()
    {
        int id = Convert.ToInt32(bookingId);
        await LoadBooking(id);
        await getHairdressers();
        await getCategories();
    
    }

    private async Task LoadBooking(int bookingId)
    {
        booking = await Http.GetFromJsonAsync<Booking>($"http://localhost:5004/api/Booking/{bookingId}");
    }

    private async Task getHairdressers()
    {
        hairdresser = await Http.GetFromJsonAsync<Hairdresser[]>("http://localhost:5004/api/Hairdresser");
    }

    private async Task getCategories()
    {
        category = await Http.GetFromJsonAsync<Category[]>("http://localhost:5004/api/Category");
    }


    public async Task UpdateBooking()
    {
        var response = await Http.PutAsJsonAsync($"http://localhost:5004/api/Booking/{booking.Id}", booking);
        response.EnsureSuccessStatusCode();

        NavigationManager.NavigateTo("/booking");
    }

    //klasser
     public class Booking
    {
        public int Id { get; set; }
        public DateTime BookingDateTime { get; set; } = DateTime.Now;
        public string Message { get; set; }
        public bool Status { get; set; } = false;
        public string HairType { get; set; }
        public string HairLength { get; set; }
        public int TimeId { get; set; } // Referens till TimeModel
        public Times Time { get; set; }
        public int HairdresserId { get; set; }
        public Hairdresser Hairdresser { get; set; }
        public int CategoryId { get; set; }
        public Category Category { get; set; }
        public int CustomerId { get; set; }
        public Customer Customer { get; set; }
    }

    public class Times
    {
        public int Id { get; set; }
        public TimeSpan Time { get; set; }
        public bool Available { get; set; }
        public DateTime Date { get; set; }
    }

    public class Hairdresser
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Description { get; set; }
        public string Speciality { get; set; }
        public string ImageName { get; set; }
        public object ImageFile { get; set; }
    }

    public class Category
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public decimal Price { get; set; }
    }

    public class Customer
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public string Email { get; set; }
        public string Password { get; set; }
    }
}